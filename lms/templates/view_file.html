<!DOCTYPE html>
<html>
<head>
  <title>View Content</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      background: #f8f9fa;
      height: 100%;
    }

    .content-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
    }

    .video-wrapper {
      position: relative;
      width: 95%;
      max-width: 1200px;
      border: 5px solid #ccc;
      overflow: hidden;
    }

    video {
      width: 100%;
      height: auto;
      display: block;
    }

    .watermark {
      position: absolute;
      font-weight: bold;
      color: rgba(0, 0, 0, 0.6);
      background-color: rgba(255, 255, 255, 0.3);
      padding: 2px 10px;
      white-space: nowrap;
      pointer-events: none;
      font-size: 1rem;
      z-index: 99;
      border-radius: 4px;
    }

    .watermark-top { top: 0; left: -100%; animation: moveLR 15s linear infinite; }
    @keyframes moveLR { 0% { left: -100%; } 100% { left: 100%; } }

    .watermark-bottom { bottom: 0; right: -100%; animation: moveRL 15s linear infinite; }
    @keyframes moveRL { 0% { right: -100%; } 100% { right: 100%; } }

    .watermark-left {
      top: -100%; left: 0;
      transform: rotate(90deg); transform-origin: left top;
      animation: moveTB 15s linear infinite;
    }
    @keyframes moveTB { 0% { top: -100%; } 100% { top: 100%; } }

    .watermark-right {
      bottom: -100%; right: 0;
      transform: rotate(-90deg); transform-origin: right bottom;
      animation: moveBT 15s linear infinite;
    }
    @keyframes moveBT { 0% { bottom: -100%; } 100% { bottom: 100%; } }

    .watermark-center {
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      animation: centerMove 10s linear infinite, pulse 3s infinite;
    }
    @keyframes centerMove {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.9; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .fullscreen-btn {
      position: absolute;
      top: 8px;
      right: 50px;
      z-index: 10;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: none;
      padding: 4px 8px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .fullscreen-btn:hover {
      background: rgba(0, 0, 0, 0.8);
    }

  </style>
</head>

<body oncontextmenu="return false;">
  <div class="content-container">
    {% with content.resource_file.url|lower as file_url %}
      {% if ".mp4" in file_url %}
        <div class="video-wrapper">
          <video id="videoPlayer" controls controlsList="nodownload" oncontextmenu="return false" width="100%">
            <source src="{{ content.resource_file.url }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>

          <!-- Watermark Overlays -->
          <div class="watermark watermark-top">{{ user.email }}</div>
          <div class="watermark watermark-bottom">{{ user.email }}</div>
          <div class="watermark watermark-left">{{ user.email }}</div>
          <div class="watermark watermark-right">{{ user.email }}</div>
          <div class="watermark watermark-center">{{ user.email }}</div>

          <!-- Fullscreen Button -->
          <button onclick="openFullscreen()" class="fullscreen-btn">⛶</button>
        </div>

      {% elif ".pdf" in file_url %}
        <iframe src="{{ content.resource_file.url }}" width="100%" height="100%" style="border:none;"></iframe>

        <!-- Watermarks for PDF -->
        <div class="watermark watermark-top">{{ user.email }}</div>
        <div class="watermark watermark-bottom">{{ user.email }}</div>
        <div class="watermark watermark-left">{{ user.email }}</div>
        <div class="watermark watermark-right">{{ user.email }}</div>
        <div class="watermark watermark-center">{{ user.email }}</div>

      {% elif ".jpg" in file_url or ".jpeg" in file_url or ".png" in file_url or ".gif" in file_url %}
        <img src="{{ content.resource_file.url }}" alt="Image" style="width: 100%; height: auto; display: block; margin: auto;">

      {% else %}
        <p class="text-danger text-center fs-4 mt-5">⚠ Unsupported file format</p>
      {% endif %}
    {% endwith %}
  </div>

  <script>
    const video = document.getElementById("videoPlayer");
    const wrapper = document.querySelector(".video-wrapper");

    function openFullscreen() {
      if (wrapper.requestFullscreen) {
        wrapper.requestFullscreen();
      } else if (wrapper.webkitRequestFullscreen) {
        wrapper.webkitRequestFullscreen();
      } else if (wrapper.msRequestFullscreen) {
        wrapper.msRequestFullscreen();
      }
    }

    // Optional: prevent native fullscreen
    document.addEventListener("fullscreenchange", () => {
      const fsElement = document.fullscreenElement;
      if (fsElement === video) {
        document.exitFullscreen().then(() => {
          wrapper.requestFullscreen();
        });
      }
    });

    // Hide native fullscreen button
    const style = document.createElement("style");
    style.textContent = `video::-webkit-media-controls-fullscreen-button { display: none !important; }`;
    document.head.appendChild(style);
  </script>
</body>
</html>
