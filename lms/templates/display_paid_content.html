<!DOCTYPE html>
<html lang="en">
  <head> {% load static %}
    <meta charset="UTF-8">
    <title>{{ course.course_title }}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
      html {
        scroll-behavior: smooth;
      }

      body {
        overflow-x: hidden;
      }

      .content-wrapper {
        padding-top: 100px;
      }

      .nav-pills .nav-link {
        border-radius: 25px;
        margin: 0 5px;
        transition: background 0.3s;
      }

      .nav-pills .nav-link:hover {
        background-color: #dee2e6;
      }

      .nav-pills .nav-link.active {
        background-color: #007bff;
        color: white;
      }

      .fade-in {
        animation: fadeInUp 0.7s ease-in-out both;
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }

        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .section-box {
        background-color: #ffffff;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 40px;
      }

      #about-section,
      #modules-section,
      #benefit-section,
      #testimonials-section,
      #progress-section {
        background-color: #f8f9fa;
        padding: 40px 20px;
        border-radius: 10px;
      }

      .btn-info,
      .btn-success {
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }

      .video-box {
        margin-bottom: 15px;
      }

      .section-box {
        background: #f4f7fb;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
      }

      .module-box {
        background: #e9f5ff;
        border-left: 6px solid #007bff;
        transition: background 0.3s;
      }

      .module-box:hover {
        background: #d0ecff;
      }

      .content-box {
        background-color: #ffffff;
        border: 1px solid #dee2e6;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .content-box:hover {
        transform: scale(1.01);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .locked-box {
        opacity: 0.85;
        border-left: 6px solid #dc3545;
      }

      .module-toggle {
        font-weight: bold;
        font-size: 1.1rem;
      }

      .bg-gradient {
        background: linear-gradient(to right, #4facfe, #00f2fe);
        font-weight: 600;
        color: #fff;
        text-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
      }

      .section-box {
        border: 1px solid #dee2e6;
        border-left: 5px solid #0d6efd;
      }

      .fade-in {
        animation: fadeInUp 0.6s ease-in-out;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .progress-section h4 {
        display: flex;
        align-items: center;
        font-weight: bold;
        font-size: 1.5rem;
      }

      .progress-bar-animated {
        animation: progressAnimation 2s ease-out forwards;
      }

      @keyframes progressAnimation {
        from {
          width: 0%;
        }

        to {
          width: var(--progress);
        }
      }

      .badge {
        font-size: 1rem;
        padding: 0.5rem 0.75rem;
      }

      .progress {
        overflow: hidden;
        background-color: #e9ecef;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, .2);
      }

      .progress-bar {
        transition: width 1.5s ease;
        font-weight: bold;
      }

      .gradient-bar {
        background: linear-gradient(90deg, #1e90ff, #00c851);
        color: white;
      }

      .review-carddd {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-radius: 10px;
      }

      .review-carddd:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
      }

      .review-header {
        font-size: 1.25rem;
        font-weight: 600;
        color: #007bff;
        margin-bottom: 15px;
      }

      .star-radio label {
        font-size: 1rem;
        cursor: pointer;
        transition: color 0.3s ease;
      }

      .star-radio input[type="radio"] {
        margin-right: 5px;
      }

      .star-radio label:hover {
        color: gold;
      }
    </style>
  </head>
  <body> {% include 'Student_Base.html' %} <div class="main" style="min-height: 100vh;">
      <div class="container content-wrapper">
        <div class="card shadow-sm border-0 fade-in section-box rounded-3 p-4 headercard">
          <div class="row g-4 align-items-center">
            <!-- Thumbnail -->


            <h3>Average Rating: {{ average_rating }} / 5</h3>

<!-- Optionally, show stars: -->
<div>
   {% for i in "12345" %}
    {% if forloop.counter <= average_rating %}
        <span>‚òÖ</span>
    {% else %}
        <span>‚òÜ</span>
    {% endif %}
{% endfor %}

</div>
            <h5 class="text-center text-primary fw-bold ">{{ course.course_title }}</h5>
            <div class="col-md-5 mb-5">
              <img src="{{ course.thumbnail.url }}" alt="Course Thumbnail" class="img-fluid rounded-3 shadow-sm w-100">
            </div>
            <!-- Course Info -->
            <div class="col-md-7 mt-5">
              <div class="mb-2">
                <strong>üë®‚Äçüè´ Instructor:</strong>
                <span class="text-muted">{{ course.instructor_name }}</span>
              </div>
              <div class="mb-2">
                <strong>üìà Level:</strong>
                <span class="text-muted">{{ course.course_level }}</span>
              </div>
              <div class="mb-2">
                <strong>‚è≥ Duration:</strong>
                <span class="text-muted">{{ course.duration }}</span>
              </div>
              <div class="mt-3">
                <strong>üìù Description:</strong>
                <p class="text-muted small mt-1">{{ course.description }}</p>
              </div>
              <div class="mb-3">
                <div class="text-dark fw-semibold mb-2">üí∞ Price:</div>
                <div class="fs-6">
                  <span class="text-decoration-line-through text-muted">‚Çπ{{ course.original_price }}</span>
                  <span class="text-success fw-bold ms-2">‚Çπ{{ course.course_price }}</span>
                  <span class="text-danger ms-2">(You save ‚Çπ{{ course.discount_amount }})</span>
                </div>
              </div> {% if not has_access %} <div class="alert alert-warning d-flex justify-content-between align-items-center mt-4 p-3 rounded-3 shadow-sm">
                <div>
                  <strong>üîí Paid Course:</strong>
                  <br> Preview content is limited.
                </div>
                <a href="{% url 'initiate_payment' course.id %}" class="btn btn-success rounded-pill px-4 py-2"> üí≥ Buy Now ‚Çπ{{ course.course_price }}
                </a>
              </div> {% endif %}
            </div>
          </div>
        </div>
      </div>
      <div class="sticky-top bg-light" style="top: 80px; z-index: 899;">
        <div class="container">
          <ul class="nav nav-pills justify-content-left py-2" id="scrollTabs">
            <li class="nav-item">
              <a class="nav-link active" href="#">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#about-section">Modules</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#modules-benefit-wrapper">Benefit</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#testimonials-section">Testimonials</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#progress-section">Progress</a>
            </li>
          </ul>
        </div>
      </div>
      <!-- Container for all sections -->
      <div class="container px-4 px-md-5">
        <section id="about-section" class="mt-5 fade-in">
          <h4 class="text-primary mb-4">
            <i class="fas fa-info-circle text-primary mr-2"></i>About
          </h4>
          <p id="about-text" style="white-space: pre-line; word-wrap: break-word;"></p>
          <script>
            // Get the raw text from Django
            const rawText = `{{ course.about|escapejs }}`;
            // Split into words
            const words = rawText.split(" ");
            const chunkSize = 10;
            let formattedText = "";
            // Add a newline after every 10 words
            for (let i = 0; i < words.length; i++) {
              formattedText += words[i] + " ";
              if ((i + 1) % chunkSize === 0) {
                formattedText += "\n";
              }
            }
            // Set it into the paragraph
            document.getElementById("about-text").innerText = formattedText.trim();
          </script>
        </section>
<section id="modules-benefit-wrapper" class="mt-5">
  <div class="row align-items-stretch">

    <!-- Modules Section -->
    <div class="col-md-6 d-flex">
      <div id="modules-section" class="p-4 bg-white rounded shadow w-100">
        <h4 class="text-primary mb-4">üìö Modules</h4>
        <div class="row" id="modules-wrapper">
          {% for title, contents in grouped_contents.items %}
            {% if has_access or forloop.counter <= 2 %}
              <div class="col-12 mb-3 module-box {% if forloop.counter > 3 %}d-none extra-module{% endif %}">
                <div class="d-flex align-items-start border rounded p-3 bg-light">
                  <div class="flex-grow-1">
                    <a class="text-dark text-decoration-none fw-bold fs-5 d-block module-toggle"
                       data-bs-toggle="collapse" href="#collapseModule{{ forloop.counter }}">
                      {{ title }}
                    </a>
                    <div class="text-muted small">
                      ‚Ä¢ Course {{ forloop.counter }} ‚Ä¢ {{ contents|length }} modules
                    </div>
                  </div>
                  <div>
                    <a class="btn btn-sm" data-bs-toggle="collapse" href="#collapseModule{{ forloop.counter }}">
                      <span class="fs-4">‚ñæ</span>
                    </a>
                  </div>
                </div>

                <div class="collapse mt-2" id="collapseModule{{ forloop.counter }}">
                  <ul class="list-group mt-2">
                    {% for content in contents %}
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-2">
                          {% if ".mp4" in content.resource_file.url %}
                            <a href="{{ content.resource_file.url }}" target="_blank" class="fw-semibold text-dark hover-underline">
                              <span class="text-danger fs-5">‚ñ∂</span> {{ content.subtitle }}
                            </a>
                            <span class="badge bg-danger ms-2">Video</span>
                          {% else %}
                            <a href="{{ content.resource_file.url }}" target="_blank" class="fw-semibold text-dark hover-underline">
                              <span class="text-primary fs-5">üìÑ</span> {{ content.subtitle }}
                            </a>
                            <span class="badge bg-primary ms-2">PDF</span>
                          {% endif %}
                        </div>

                        {% if has_access %}
                          <form method="POST" action="{% url 'mark_content_complete' %}" class="ms-3">
                            {% csrf_token %}
                            <input type="hidden" name="course_id" value="{{ course.id }}">
                            <input type="hidden" name="content_id" value="{{ content.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-success" title="Mark as Complete">‚úî</button>
                          </form>
                        {% endif %}
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            {% else %}
              {% if forloop.counter == 3 %}
                <div class="col-12">
                  <div class="alert alert-secondary">
                    üîí Modules locked ‚Äî <strong>Please <a href="{% url 'initiate_payment' course.id %}" class="text-success">buy the course</a> to unlock remaining content.</strong>
                  </div>
                </div>
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>

        {% if grouped_contents|length > 3 %}
          <!-- Toggle Button -->
          <div class="text-center mt-3">
            <button class="btn btn-outline-primary btn-sm" id="toggle-modules-btn">View More</button>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Benefits Section -->
    <div class="col-md-6 d-flex">
      <div id="benefit-section" class="p-4 bg-white rounded shadow w-100">
        <h4 class="text-primary mb-4">üéØ Benefits</h4>
        <p style="white-space: pre-line; word-wrap: break-word;">{{ course.benefits }}</p>
      </div>
    </div>

  </div>
</section>

<!-- JS for View More/Less toggle -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleBtn = document.getElementById("toggle-modules-btn");
    if (toggleBtn) {
      const extraModules = document.querySelectorAll(".extra-module");
      let expanded = false;

      toggleBtn.addEventListener("click", () => {
        extraModules.forEach(el => el.classList.toggle("d-none"));
        expanded = !expanded;
        toggleBtn.textContent = expanded ? "View Less" : "View More";
      });
    }
  });
</script>

        <section id="testimonials-section" class="mt-5 section-box fade-in">
          <hr>
          <!-- Reviews Header -->
          <div class="text-center my-5">
            <h3 class="font-weight-bold text-primary">What Our Students Say...</h3>
            <hr style="width: 100px; border-top: 3px solid #007bff; margin: 0 auto;">
          </div>
          <!-- Reviews Row -->
          <div class="row"> {% for review in reviews %} <div class="col-md-3 review-card {% if forloop.counter > 4 %}d-none extra-review{% endif %}">
              <div class="card mb-3 p-3 shadow">
                <div class="d-flex align-items-start">
                  <!-- Avatar -->
                  <div class="rounded-circle d-flex justify-content-center align-items-center mr-3" style="width:60px; height:50px; background-color:#e0e0e0; font-size:17px; font-weight:bold; color:#007bff;"> {% if review.user.first_name %} {{ review.user.first_name|first|upper }} {% else %} {{ review.display_name|first|upper }} {% endif %} </div>
                  <!-- Review Content -->
                  <div class="w-100">
                    <h6 class="mb-1 font-weight-bold"> {% if review.user.first_name or review.user.last_name %} {{ review.user.first_name }} {{ review.user.last_name }} {% else %} {{ review.display_name }} {% endif %} </h6>
                    <p class="text-muted mb-1" style="font-size: 0.9rem;">Learner since {{ review.created_at|date:"Y" }}</p>
                    <!-- Rating -->
                    <p class="mb-1"> {% for i in "12345" %} {% if forloop.counter <= review.rating %} <span style="color: gold;">‚òÖ</span> {% else %} <span style="color: lightgray;">‚òÖ</span> {% endif %} {% endfor %} </p>
                    <!-- Review Text with toggle --> {% if review.review|wordcount > 5 %} <p class="card-text text-dark" id="short-review-{{ review.id }}"> "{{ review.review|truncatewords:9 }}" <a href="javascript:void(0);" onclick="toggleReview('{{ review.id }}')">Read more</a>
                    </p>
                    <p class="card-text text-dark d-none" id="full-review-{{ review.id }}"> "{{ review.review }}" <a href="javascript:void(0);" onclick="toggleReview('{{ review.id }}')">Read less</a>
                    </p> {% else %} <p class="card-text text-dark">"{{ review.review }}"</p> {% endif %} <small class="text-muted">Posted on {{ review.created_at|date:"d M Y" }}</small> {% if review.user == request.user %} <form method="POST" class="mt-2"> {% csrf_token %} <input type="hidden" name="review_id" value="{{ review.id }}">
                      <textarea name="review" class="form-control mb-2" rows="2" required>{{ review.review }}</textarea>
                      <div class="form-group"> {% for i in "12345" %} <label class="mr-1">
                          <input type="radio" name="rating" value="{{ i }}" {% if review.rating == i|add:"0" %}checked{% endif %}> {{ i }} ‚òÖ </label> {% endfor %} </div>
                      <button type="submit" name="update_review" class="btn btn-sm btn-success">Update</button>
                      <button type="submit" name="delete_review" class="btn btn-sm btn-danger ml-2">Delete</button>
                    </form> {% endif %}
                  </div>
                </div>
              </div>
            </div> {% empty %} <p>No reviews yet.</p> {% endfor %} </div>
          <!-- Show More Button --> {% if reviews|length > 8 %} <div class="text-center mt-4">
            <button class="btn btn-outline-primary" id="showMoreBtn" onclick="showMoreReviews()">Show More</button>
          </div> {% endif %} {% if has_access %} <div class="row">
            <div class="col-md-12">
              <div class="card shadow-sm review-carddd p-4 bg-white">
                <div class="card-body">
                  <div class="review-header">üìù Write a Review</div>
                  <form method="POST" class="mb-3"> {% csrf_token %} <input type="hidden" name="submit_review" value="1">
                    <div class="form-group">
                      <textarea name="review" class="form-control" rows="3" placeholder="Share your thoughts..." required></textarea>
                    </div>
                    <div class="form-group star-radio">
                      <label>Rate the Course:</label>
                      <br> {% for i in "12345" %} <label class="mr-2">
                        <input type="radio" name="rating" value="{{ i }}"> {{ i }} ‚òÖ </label> {% endfor %}
                    </div>
                    <center>
                      <button type="submit" class="btn btn-primary btn-block" style="width: 150px;">Submit Review</button>
                    </center>
                  </form>
                </div>
              </div>
            </div>
          </div> {% else %} <p class="text-muted text-center">Buy the course to write a review.</p> {% endif %}
        </section>
        <section id="progress-section" class="mt-5">
          <div class="section-box fade-in p-4 rounded bg-light shadow-sm progress-section">
            <h4 class="text-primary mb-3">üìà Your Course Progress</h4> {% if progress_percentage is not None %} <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">Completed:</h5>
              <span class="badge bg-success">{{ progress_percentage }}%</span>
            </div>
            <div class="progress" style="height: 25px; border-radius: 30px;">
              <div class="progress-bar gradient-bar progress-bar-animated" role="progressbar" style="--progress: {{ progress_percentage }}%; width: 0%;" aria-valuenow="{{ progress_percentage }}" aria-valuemin="0" aria-valuemax="100">
                {{ progress_percentage }}%
              </div>
            </div> {% else %} <div class="alert alert-info mt-3"> üöÄ You haven't started this course yet. Let‚Äôs begin! </div> {% endif %}
          </div>
        </section>
        <script>
          window.addEventListener('load', () => {
            const bar = document.querySelector('.progress-bar');
            if (bar) {
              const target = bar.style.getPropertyValue('--progress');
              bar.style.width = target;
            }
          });
        </script>
      </div>
    </div>
    <!-- JavaScript for toggling extra modules -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const toggleBtn = document.getElementById("toggle-modules-btn");
        if (toggleBtn) {
          const extraModules = document.querySelectorAll(".extra-module");
          let expanded = false;
          toggleBtn.addEventListener("click", () => {
            extraModules.forEach(el => el.classList.toggle("d-none"));
            expanded = !expanded;
            toggleBtn.textContent = expanded ? "View Less" : "View More";
          });
        }
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('#scrollTabs .nav-link');
        const sections = document.querySelectorAll('section[id]');
        window.addEventListener('scroll', function() {
          let current = '';
          sections.forEach(section => {
            const sectionTop = section.offsetTop - 150; // Adjust offset for better detection
            if (window.pageYOffset >= sectionTop) {
              current = section.getAttribute('id');
            }
          });
          navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${current}`) {
              link.classList.add('active');
            }
          });
        });
      });

      function toggleReview(id) {
        const short = document.getElementById(`short-review-${id}`);
        const full = document.getElementById(`full-review-${id}`);
        if (short.classList.contains("d-none")) {
          short.classList.remove("d-none");
          full.classList.add("d-none");
        } else {
          short.classList.add("d-none");
          full.classList.remove("d-none");
        }
      }

      function showMoreReviews() {
        const hidden = document.querySelectorAll('.extra-review');
        hidden.forEach(card => card.classList.remove('d-none'));
        document.getElementById('showMoreBtn').style.display = 'none';
      }
    </script> {% include 'footer.html' %} <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>